<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="description" content="reed leoneil">
  <meta name="keywords" content="reed leoneil">
  <meta name="author" content="@reedleoneil">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pon's Japanese Cheat Sheet</title>
  <link rel="icon" type="image/png" href="https://reedleoneil.github.io/IMG_0020.PNG">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
  <style>
  body {
    font-family: monospace;
    font-size: 1em;
    width: 100%;
    padding-left: 20px;
    padding-right: 20px;
    margin-left: auto;
    margin-right: auto;
    max-width:96em;
    color: #333333;
  }

  .re-border {
    box-shadow: 
    -1px -1px 0 #696969,
    1px -1px 0 #696969,
    -1px 1px 0 #696969,
    1px 1px 0 #696969,
    -1px -1px 3px #696969,
    1px -1px 3px #696969,
    -1px 1px 3px #696969,
    1px 1px 3px #696969;
    padding: 5px 5px;
  }

  .re-button {
    width: 100%;
  }

  .re-panel-header {
    background-color: #000000;
    -webkit-text-stroke: 0.1px #696969;
    color: #FFFFFF;
    text-shadow: 
    -0.01px -0.01px 0 #696969, 
    0.01px -0.01px 0 #696969, 
    -0.01px 0.01px 0 #696969, 
    0.01px 0.01px 0 #696969, 
    -0.01px -0.01px 3px #696969, 
    0.01px -0.01px 3px #696969, 
    -0.01px 0.01px 3px #696969, 
    0.01px 0.01px 3px #696969;
    font-weight: bold;
    cursor:pointer;
  }

  .re-table {
    width: 100%;
    white-space: nowrap;
  }

  .re-table tr th,
  .re-table tr td {
    padding-right: 1rem;
  }

  .re-table tr th:last-child,
  .re-table tr td:last-child {
    padding-right: 0 !important;
  }

  .re-table th {
    background-color: #000000;
    -webkit-text-stroke: 0.1px #696969;
    color: #FFFFFF;
    text-shadow: 
    -0.01px -0.01px 0 #696969, 
    0.01px -0.01px 0 #696969, 
    -0.01px 0.01px 0 #696969, 
    0.01px 0.01px 0 #696969, 
    -0.01px -0.01px 3px #696969, 
    0.01px -0.01px 3px #696969, 
    -0.01px 0.01px 3px #696969, 
    0.01px 0.01px 3px #696969;
    font-weight: bold;
  }

  #main-panel {
    font-family:"ヒラギノ角ゴ Pro W3", "Hiragino Kaku Gothic Pro",Osaka, "メイリオ", Meiryo, "ＭＳ Ｐゴシック", "MS PGothic", sans-serif;
  }

  .popover {
    max-width: 96vw;
  }

  .white {
    background-color:white;
  }

  span.n5, 
  span.n4, 
  span.n3 {
    padding: 0.20em;
  }

  #div-kanji-span-list.n5 span.n5,
  #div-kanji-span-list.n4 span.n4,
  #div-kanji-span-list.n3 span.n3,
  #div-kanji-vocabulary-list.n5 tr.n5,
  #div-kanji-vocabulary-list.n4 tr.n4,
  #div-kanji-vocabulary-list.n3 tr.n3,
  #div-kanji-span-list.kana table td.kana,
  #div-kanji-span-list.meaning td.meaning, 
  #div-kanji-vocabulary-list.kana td.kana, 
  #div-kanji-vocabulary-list.meaning td.meaning
  {
    display: none;
  }

  #div-vocabulary-list .kanji {
    display: none;
  }

  #div-vocabulary-list.kana .kanji {
    display: unset;
  }

  #div-vocabulary-list.kana td.kana,
  #div-vocabulary-list.meaning td.meaning,
  #div-vocabulary-list.n5 tr.n5,
  #div-vocabulary-list.n4 tr.n4,
  #div-vocabulary-list.n3 tr.n3 {
    display: none;
  }

  /* The side navigation menu */
  .sidebar {
    width: 25em;
    position: fixed;
    height: 100%;
    /* overflow: auto; */
  }

  /* Page content. The value of the margin-left property should match the value of the sidebar's width property */
  div.content {
    margin-left: 25em;
  }

  /* On screens that are less than 700px wide, make the sidebar into a topbar */
  @media screen and (max-width: 700px) {
    .sidebar {
      /* todo */
      position: relative;
    }
    div.content {margin-left: 0;}
  }

  /* On screens that are less than 400px, display the bar vertically, instead of horizontally */
  @media screen and (max-width: 400px) {
    .sidebar a {
      /* todo */
      text-align: center;
      float: none;
    }
  } 
  </style>
</head>
<body>
  <!-- The sidebar -->
  <div class="sidebar py-2 px-1">
    <div class="row">
      <div class="col-12">
        <div class="re-border">
          <div id="left-panel">
            <div>
              <div class="re-panel-header mb-1 px-1 pt-1 text-center">ポンの日本語総まとめ</div>
            </div>
            <div>
              <div id="kanji-nav" class="re-panel-header mt-1 px-1 pt-1" data-bs-toggle="collapse" data-bs-target="#kanji-collapse">漢字 Kanji</div>
              <div id="kanji-collapse" class="collapse" data-bs-parent="#left-panel">
                <div class="mt-1">
                  <div>
                    <label for="kanji-level"><b>Level:</b></label>
                    <input type="checkbox" id="n5-kanji-checkbox" name="kanji-level" value="n5" checked> N5
                    <input type="checkbox" id="n4-kanji-checkbox" name="kanji-level" value="n4" checked> N4 
                    <input type="checkbox" id="n3-kanji-checkbox" name="kanji-level" value="n3" checked> N3
                    <input type="checkbox" id="n2-kanji-checkbox" name="kanji-level" value="n2" disabled> N2
                    <input type="checkbox" id="n1-kanji-checkbox" name="kanji-level" value="n1" disabled> N1
                  </div>
                  <div>
                    <label for="kanji-mode"><b>Mode:</b></label>
                    <select id="kanji-mode">
                      <option value="kanji">Kanji</option>
                      <option value="vocabulary">Vocabulary</option>
                    </select>
                  </div>
                  <div>
                    <label for="display"><b>Display:</b></label>
                    <input type="checkbox" id="kanji-kana-display" name="kanji-display" value="kana" checked> 仮名
                    <input type="checkbox" id="kanji-meaning-display" name="kanji-display" value="meaning" checked> 意味
                  </div>
                  <div>
                      <label for="kanji-span-list-font-size"><b>Font Size:</b></label>
                      <input type="range" id="kanji-span-list-font-size" min="100" max="300" value="193" style="vertical-align:middle;" />
                  </div>
                  <div>
                    <label for="display"><b>Offset:</b></label>
                    <input type="number" id="kanji-offset" name="kanji-offset" class="w-25" min="0" style="height: 18px;" />
                    <label for="display"><b>Count:</b></label>
                    <input type="number" id="kanji-count" name="kanji-count" class="w-25" min="0" style="height: 18px;" /> 
                  </div>
                  <button type="button" id="kanji-shuffle-button" class="re-button">Shuffle</button> 
                  <br>
                </div>
              </div>
            </div>
            <div>
              <div id="vocabulary-nav" class="re-panel-header mt-1 px-1 pt-1" data-bs-toggle="collapse" data-bs-target="#vocabulary-collapse">語彙 Vocabulary</div>
              <div id="vocabulary-collapse" class="collapse" data-bs-parent="#left-panel">
                <div class="mt-1">
                  <div>
                    <label for="kanji-level"><b>Level:</b></label>
                    <input type="checkbox" id="n5-vocabulary-checkbox" name="vocabulary-level" value="n5" checked> N5
                    <input type="checkbox" id="n4-vocabulary-checkbox" name="vocabulary-level" value="n4" checked> N4 
                    <input type="checkbox" id="n3-vocabulary-checkbox" name="vocabulary-level" value="n3" checked> N3
                    <input type="checkbox" id="n2-vocabulary-checkbox" name="vocabulary-level" value="n2" disabled> N2
                    <input type="checkbox" id="n1-vocabulary-checkbox" name="vocabulary-level" value="n1" disabled> N1
                  </div>
                  <div>
                    <label for="display"><b>Display:</b></label>
                    <input type="checkbox" id="vocabulary-kana-display" name="vocabulary-display" value="kana" checked> 仮名
                    <input type="checkbox" id="vocabulary-meaning-display" name="vocabulary-display" value="meaning" checked> 意味
                  </div>
                  <div>
                    <label for="display"><b>Offset:</b></label>
                    <input type="number" id="vocabulary-offset" name="vocabulary-offset" class="w-25" min="0" style="height: 18px;" />
                    <label for="display"><b>Count:</b></label>
                    <input type="number" id="vocabulary-count" name="vocabulary-count" class="w-25" min="0" style="height: 18px;" /> 
                  </div>
                  <button type="button" id="vocabulary-shuffle-button" class="re-button">Shuffle</button> 
                </div>
              </div>
            </div>
            <div>
              <div id="grammar-nav" class="re-panel-header mt-1 px-1 pt-1" data-bs-toggle="collapse" data-bs-target="#grammar-collapse">文法 Grammar</div>
              <div id="grammar-collapse" class="collapse" data-bs-parent="#left-panel">
                <div class="mt-1">
                  <a href="https://reedleoneil.github.io/pon-jp-cheat-sheet/cheat-sheet/grammar/">pon-jp-cheat-sheet</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Page content -->
  <div class="content py-2 px-1">
    <div class="row">
      <div class="col-12">
        <div class="re-border">
          <div id="main-panel">
            <p><ruby>日本語<rt>にほんご</rt></ruby> Kodigo</p>
            <p>kódigó: [noun] code • cheat sheet • crib note</p>
            <p>I studied Japanese language for around 2 years by myself. I used a lot of resources like Genki I & II, Udemy Online Japanese Course, Tae Kim's Guide to Japanese Grammar, etc.. but still failed JLPT N4 examination last December 2019.</p>
            <p>I am still learning N4 and my goal is to reach at least N3 level. I will be updating this cheat sheet regularly when I am reviewing or learning any vocabulary, kanji or grammar.</p>
            <p>Update February 10, 2021:</p>
            <p>I have completed studying N4 and currently reviewing. I will be soon starting N3 and looking forward to reach N2.</p>
            <p>Link for <a href="https://reedleoneil.github.io/pon-jp-cheat-sheet/">v1 markdown</a></p>
          </div>
        </div>
      </div>
    </div>
  </div> 

  <script src="https://code.responsivevoice.org/responsivevoice.js?key=AnA6zAr0"></script> 

  <script>
  var KANJILIST = [];
  var KANJIVOCABULARYLIST = [];
  var VOCABULARYLIST = [];

  var KANJILISTCOUNT;
  var KANJIVOCABULARYLISTCOUNT;
  var VOCABULARYLISTCOUNT;

  const _fetchData = (level = 5) => {
    let _level = level;
    fetch('kanji-n' + _level + '.json')
    .then(response => response.json())
    .then(data => {

      data.forEach((kanji, index) => {
        kanji.id = KANJILIST.length + (index + 1);
        kanji.level = 'n' + _level;
        kanji.vocabulary.forEach(vocabulary => {
          vocabulary.id = KANJILIST.length + (index + 1);
          vocabulary.level = 'n' + _level;
        }); 
      });

      KANJILIST = KANJILIST.concat(data);
      KANJILISTCOUNT = KANJILIST.length;

      KANJILIST.forEach(kanji => { 
        KANJIVOCABULARYLIST = KANJIVOCABULARYLIST.concat(kanji.vocabulary);
        KANJIVOCABULARYLISTCOUNT = KANJIVOCABULARYLIST.length;
      });
    });

    fetch('vocabulary-n' + _level + '.json')
    .then(response => response.json())
    .then(data => {
      data.forEach((vocabulary, index) => { 
        vocabulary.id = VOCABULARYLIST.length + (index + 1);
        vocabulary.level = 'n' + _level;
      });
   
      VOCABULARYLIST = VOCABULARYLIST.concat(data);
      VOCABULARYLISTCOUNT = VOCABULARYLIST.length;
    });

    if (--level >= 3) { _fetchData(level); }
  };

  _fetchData();

  // fetch('vocabulary-n3-s.json')
  // .then(response => response.json())
  // .then(data => {
  //   data.forEach(vocabulary => { 
  //     vocabulary.level = 'n3';
  //   });
  
  //   VOCABULARYLIST = VOCABULARYLIST.concat(data);
  // });
  
  /* 
   * Helper Functions
   */

  const _shuffle = (array) => {
    for (let i = array.length - 1; i > 0; i--) {
      let j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  };
  
  const _hideElement = (selector) => {
    document.querySelectorAll(selector).forEach((element) => element.style.display = 'none');
  };

  const _showElement = (selector) => {
    document.querySelectorAll(selector).forEach((element) => element.style.display = '');
  };
  /* 
   * Element Generator
   */

  const _generateKanjiSpanList = (kanji) => {
    let div = document.createElement('div');

    KANJILIST.forEach((k, index) => {
      let span = document.createElement('span');
          span.classList.add("kanji");
          span.classList.add(k.level);
          span.classList.add('k-' + k.id);
          span.setAttribute('data-bs-toggle', 'popover');
          span.setAttribute('data-bs-trigger', 'hover');
          span.setAttribute('title', k.meaning);
          span.setAttribute('data-bs-content', _generateDataContent(k.vocabulary).outerHTML);
          span.innerText = k.kanji;

        div.appendChild(span);
    });
     
    return div;
  };

  const _generateDataContent = (vocabulary) => {
    let div = document.createElement('div');
    let table = document.createElement('table');
        table.setAttribute('class', 're-table');
    div.appendChild(table);

    vocabulary.forEach((v, index) => {
      let tr = document.createElement('tr');
      table.appendChild(tr);

      let tdKanji = document.createElement('td');
          tdKanji.innerText = v.kanji;
      tr.appendChild(tdKanji);

      let tdKana = document.createElement('td');
          tdKana.innerText = v.kana;
          tdKana.setAttribute('class', 'kana');
      tr.appendChild(tdKana);

      let tdMeaning = document.createElement('td');
          tdMeaning.innerText = v.meaning;
          tdMeaning.setAttribute('class', 'meaning');
      tr.appendChild(tdMeaning);
    });

    return div;
  };

  const _generateKanjiVocabularyList = () => {
    let div = document.createElement('div');
        div.setAttribute('style', 'overflow-x:auto;');
        
    let table = document.createElement('table');
        table.setAttribute('class', 're-table');

    div.appendChild(table);

    KANJIVOCABULARYLIST.forEach((v, index) => {
      let tr = document.createElement('tr');
          tr.classList.add("kanji");
          tr.classList.add(v.level);
          tr.classList.add('k-' + v.id);
      table.appendChild(tr);

      let tdKanji = document.createElement('td');
          tdKanji.innerText = v.kanji;
      tr.appendChild(tdKanji);

      let tdKana = document.createElement('td');
        tdKana.innerText = v.kana;
          tdKana.setAttribute('class', 'kana');
      tr.appendChild(tdKana);

      let tdMeaning = document.createElement('td');
          tdMeaning.innerText = v.meaning;
          tdMeaning.setAttribute('class', 'meaning');
      tr.appendChild(tdMeaning);
    });
     
    return div;
  };

  const _generateVocabularyList = () => {
    let div = document.createElement('div');
        div.setAttribute('style', 'overflow-x:auto;');
        
    let table = document.createElement('table');
        table.setAttribute('class', 're-table');

    div.appendChild(table);

    VOCABULARYLIST.forEach((v, index) => {
      let tr = document.createElement('tr');
          tr.classList.add("vocabulary");
          tr.classList.add(v.level);
          tr.classList.add('v-' + v.id);
      table.appendChild(tr);

      let tdKanji = document.createElement('td');
          tdKanji.innerText = v.kanji;
      tr.appendChild(tdKanji);

      if (!v.kanji) {
        let spanKana = document.createElement('span');
            spanKana.innerText = v.kana;
            spanKana.setAttribute('class', 'kanji');
        tdKanji.appendChild(spanKana);
      }

      let tdKana = document.createElement('td');
        tdKana.innerText = v.kana;
          tdKana.setAttribute('class', 'kana');
      tr.appendChild(tdKana);

      let tdMeaning = document.createElement('td');
          tdMeaning.innerText = v.meaning;
          tdMeaning.setAttribute('class', 'meaning');
      tr.appendChild(tdMeaning);
    });
     
    return div;
  };

  /* 
   * Filters
   */

  const _getKanjiLevel = () => {
    let checked = [];
    let unchecked = [];
    document.querySelectorAll('input[name="kanji-level"]:checked').forEach((checkbox) => { checked.push(checkbox.value) });
    document.querySelectorAll('input[name="kanji-level"]:not(:checked)').forEach((checkbox) => { unchecked.push(checkbox.value) });
    return {
      checked: checked,
      unchecked: unchecked
    };
  };

  const _getKanjiMode = () => {
    return document.getElementById('kanji-mode').value;
  };

  const _getKanjiDisplay = () => {    
    let checked = [];
    let unchecked = [];
    document.querySelectorAll('input[name="kanji-display"]:checked').forEach((checkbox) => { checked.push(checkbox.value) });
    document.querySelectorAll('input[name="kanji-display"]:not(:checked)').forEach((checkbox) => { unchecked.push(checkbox.value) });
    return {
      checked: checked,
      unchecked: unchecked
    };
  };

  const _getKanjiFontSize = () => {
    return document.getElementById('kanji-span-list-font-size').value;
  };

  const _getKanjiOffsetCount = () => {
    return {
      offset: document.getElementById('kanji-offset').value,
      count: document.getElementById('kanji-count').value
    };
  };
  
  const _getVocabularyLevel = () => {
    let checked = [];
    let unchecked = [];
    document.querySelectorAll('input[name="vocabulary-level"]:checked').forEach((checkbox) => { checked.push(checkbox.value) });
    document.querySelectorAll('input[name="vocabulary-level"]:not(:checked)').forEach((checkbox) => { unchecked.push(checkbox.value) });
    return {
      checked: checked,
      unchecked: unchecked
    };
  }

  const _getVocabularyDisplay = () => {
    let checked = [];
    let unchecked = [];  
    document.querySelectorAll('input[name="vocabulary-display"]:checked').forEach((checkbox) => { checked.push(checkbox.value) });
    document.querySelectorAll('input[name="vocabulary-display"]:not(:checked)').forEach((checkbox) => { unchecked.push(checkbox.value) });
    return {
      checked: checked,
      unchecked: unchecked
    };
  };

  const _getVocabularyOffsetCount = () => {
    return {
      offset: document.getElementById('vocabulary-offset').value,
      count: document.getElementById('vocabulary-count').value
    };
  };

  /* 
   * Event Callback
   */

  const _onKanjiNavClicked = () => {
    let mode = _getKanjiMode();

    switch (mode) {
      case 'kanji':        
        _renderKanjiSpanList();
        break;
      case 'vocabulary':
        _renderKanjiVocabularyList();
        break;
    }
  };

  const _onKanjiLevelClicked = () => {
    let level = _getKanjiLevel();
    let mode = _getKanjiMode();
    let div = document.getElementById(mode === 'kanji' ? 'div-kanji-span-list' : 'div-kanji-vocabulary-list');
    level.checked.forEach(l => div.classList.remove(l));
    level.unchecked.forEach(l => div.classList.add(l));
  };

  const _onKanjiModeClicked = () => {
    let mode = _getKanjiMode();

    switch (mode) {
      case 'kanji':        
        _renderKanjiSpanList();
        break;
      case 'vocabulary':
        _renderKanjiVocabularyList();
        break;
    }
    _onKanjiOffsetCountChanged();
  };

  const _onKanjiDisplayClicked = () => {
    let display = _getKanjiDisplay();
    let mode = _getKanjiMode();
    let div = document.getElementById(mode === 'kanji' ? 'div-kanji-span-list' : 'div-kanji-vocabulary-list');
    display.checked.forEach(d => div.classList.remove(d));
    display.unchecked.forEach(d => div.classList.add(d));
  };

  const _onKanjiFontSizeChanged = () => {
    let fontSize = _getKanjiFontSize();
    let mode = _getKanjiMode();
    document.getElementById(mode === 'kanji' ? 'div-kanji-span-list' : 'div-kanji-vocabulary-list').setAttribute('style', 'font-size: ' + fontSize + '%;');
  };

  const _onKanjiOffsetCountChanged = () => {
    let filter = _getKanjiOffsetCount();
    let offset = parseInt(filter.offset);
    let count = parseInt(filter.count);
    
    for (var j = 1; j <= offset; j++) 
      _hideElement('.kanji.k-'+ j);

    for (var j = offset + 1; j <= offset + count; j++)
      _showElement('.kanji.k-'+ j);

    for (var j = offset + count + 1; j <= KANJILISTCOUNT; j++)
      _hideElement('.kanji.k-'+ j);
  };

  const _onShuffleKanjiClicked = () => {
    let mode = _getKanjiMode();

    switch (mode) {
      case 'kanji':
        _shuffle(KANJILIST);
        KANJILIST.forEach(k => _shuffle(k.vocabulary));
        _renderKanjiSpanList();
      
        document.querySelectorAll('body span').forEach((s) => s.ondblclick = function(e) {
          let span = e.target.textContent;
          let obj = KANJILIST.find( k => k.kanji == span);
          KANJILIST = KANJILIST.filter(k => k.id != obj.id);
          e.target.remove();
          Array.from(document.querySelectorAll('.popover')).forEach(p => _hideElement("#" + p.id));
        });

        break;
      case 'vocabulary':
        _shuffle(KANJIVOCABULARYLIST);
        _renderKanjiVocabularyList();

        document.querySelectorAll('body tr').forEach((t) => t.ondblclick = function(e) {
          let tr = e.target.closest('tr').textContent;
          let obj = KANJIVOCABULARYLIST.find(v => (v.kanji ? tr.includes(v.kanji) : true)
		    								                 && (v.kana ? tr.includes(v.kana): true) 
		    								                 && (v.meaning ? tr.includes(v.meaning) : true));
          KANJIVOCABULARYLIST = KANJIVOCABULARYLIST.filter(v => v != obj);
          e.target.closest('tr').remove();
        });

        break;
    }
    _onKanjiOffsetCountChanged();
  };

  const _onVocabularyNavClicked = () => {
    _renderVocabularyList();
  };

  const _onVocabularyLevelClicked = () => {
    let level = _getVocabularyLevel();
    let div = document.getElementById('div-vocabulary-list');
    level.checked.forEach(l => div.classList.remove(l));
    level.unchecked.forEach(l => div.classList.add(l));
  };

  const _onVocabularyDisplayClicked = () => {
    let display = _getVocabularyDisplay();
    let div = document.getElementById('div-vocabulary-list');
    display.checked.forEach(d => div.classList.remove(d));
    display.unchecked.forEach(d => div.classList.add(d));
  };

  const _onVocabularyOffsetCountChanged = () => {
    let filter = _getVocabularyOffsetCount();
    let offset = parseInt(filter.offset);
    let count = parseInt(filter.count);
    
    for (var j = 1; j <= offset; j++) 
      _hideElement('.vocabulary.v-'+ j);

    for (var j = offset + 1; j <= offset + count; j++)
      _showElement('.vocabulary.v-'+ j);

    for (var j = offset + count + 1; j <= VOCABULARYLISTCOUNT; j++)
      _hideElement('.vocabulary.v-'+ j);
  };

  const _onShuffleVocabularyClicked = () => {
    _shuffle(VOCABULARYLIST);
    _renderVocabularyList();

    document.querySelectorAll('body tr').forEach((t) => t.ondblclick = function(e) { 			
      let tr = e.target.closest('tr').textContent;
      let obj = VOCABULARYLIST.find(v => (v.kanji ? tr.includes(v.kanji) : true)
										                 && (v.kana ? tr.includes(v.kana): true) 
										                 && (v.meaning ? tr.includes(v.meaning) : true));
      VOCABULARYLIST = VOCABULARYLIST.filter(v => v != obj);
      e.target.closest('tr').remove();
    });

    _onVocabularyOffsetCountChanged();
  };

  const _onKeyPress = (k) => {
    let isKanjiSpan = !!document.getElementById('div-kanji-span-list');
    let isKanjiVocabList = !!document.getElementById('div-kanji-vocabulary-list');
    let isVocabList = !!document.getElementById('div-vocabulary-list');

    switch(k.key) {
      case '1':
      case '2':
      case '3':
      case '4':
      case '5':
        if (!['kanji-offset','kanji-count', 'vocabulary-offset', 'vocabulary-count'].includes(document.activeElement.id))
          document.getElementById(isKanjiSpan || isKanjiVocabList ? 'n' + k.key + '-kanji-checkbox' : isVocabList ? 'n' + k.key + '-vocabulary-checkbox' : '').click();
        break;      
      case 'q':
        document.getElementById(isKanjiSpan || isKanjiVocabList ? 'kanji-kana-display' : isVocabList ? 'vocabulary-kana-display' : '').click();
        break;      
      case 'w':
        document.getElementById(isKanjiSpan || isKanjiVocabList ? 'kanji-meaning-display' : isVocabList ? 'vocabulary-meaning-display' : '').click();
        break;      
      case 'e':
        document.getElementById(isKanjiSpan || isKanjiVocabList ? 'kanji-shuffle-button' : isVocabList ? 'vocabulary-shuffle-button' : '').click();
        break;
    } 
  };

  /* 
   * Render Functions
   */

  const _renderKanjiSpanList = () => {
    let element = _generateKanjiSpanList();    
    let level = _getKanjiLevel();
    let display = _getKanjiDisplay();
    let fontSize = _getKanjiFontSize();

    element.setAttribute('id', 'div-kanji-span-list');
    element.setAttribute('style', 'font-size: ' + fontSize + '%;');
    level.checked.forEach(l => element.classList.remove(l));
    level.unchecked.forEach(l => element.classList.add(l));
    display.checked.forEach(d => element.classList.remove(d));
    display.unchecked.forEach(d => element.classList.add(d));
    document.getElementById('main-panel').innerHTML = element.outerHTML;
     
    var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
    var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
      return new bootstrap.Popover(popoverTriggerEl, {
        html: true,
        sanitize: false,
        container: '#div-kanji-span-list'
      });
    });
  };

  const _renderKanjiVocabularyList = () => {
    let element = _generateKanjiVocabularyList();
    let level = _getKanjiLevel();
    let display = _getKanjiDisplay();

    element.setAttribute('id', 'div-kanji-vocabulary-list');
    level.checked.forEach(l => element.classList.remove(l));
    level.unchecked.forEach(l => element.classList.add(l));
    display.checked.forEach(d => element.classList.remove(d));
    display.unchecked.forEach(d => element.classList.add(d));
    document.getElementById('main-panel').innerHTML = element.outerHTML;
  };

  const _renderVocabularyList = () => {
    let element = _generateVocabularyList();
    let level = _getVocabularyLevel();
    let display = _getVocabularyDisplay();

    element.setAttribute('id', 'div-vocabulary-list');
    level.checked.forEach(l => element.classList.remove(l));
    level.unchecked.forEach(l => element.classList.add(l));
    display.checked.forEach(d => element.classList.remove(d));
    display.unchecked.forEach(d => element.classList.add(d));
    document.getElementById('main-panel').innerHTML = element.outerHTML;
  };

  document.querySelectorAll('input[name="kanji-level"]').forEach((checkbox) => checkbox.onclick = _onKanjiLevelClicked);
  document.getElementById('kanji-mode').onchange = _onKanjiModeClicked;
  document.querySelectorAll('input[name="kanji-display"]').forEach((checkbox) => checkbox.onclick = _onKanjiDisplayClicked);
  document.getElementById('kanji-span-list-font-size').onchange = _onKanjiFontSizeChanged;
  document.getElementById('kanji-offset').onchange = _onKanjiOffsetCountChanged;
  document.getElementById('kanji-count').onchange = _onKanjiOffsetCountChanged;
  document.getElementById('kanji-shuffle-button').onclick = _onShuffleKanjiClicked;

  document.querySelectorAll('input[name="vocabulary-level"]').forEach((checkbox) => checkbox.onclick = _onVocabularyLevelClicked);
  document.querySelectorAll('input[name="vocabulary-display"]').forEach((checkbox) => checkbox.onclick = _onVocabularyDisplayClicked);
  document.getElementById('vocabulary-offset').onchange = _onVocabularyOffsetCountChanged;
  document.getElementById('vocabulary-count').onchange = _onVocabularyOffsetCountChanged;
  document.getElementById('vocabulary-shuffle-button').onclick = _onShuffleVocabularyClicked;

  document.getElementById('kanji-nav').onclick = _onKanjiNavClicked;
  document.getElementById('vocabulary-nav').onclick = _onVocabularyNavClicked;

  document.querySelector('html').onkeypress = _onKeyPress;
  </script>
</body>
</html>
